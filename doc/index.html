<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>tigsite</title>
    <meta name="description" content="A tool to assist the development of a static site">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <link rel="copyright" href="http://www.gnu.org/copyleft/gpl.html"/>
    <link rel="stylesheet" href="static/tigsite.css" type="text/css">
</head>

<body>

    <header>
<h1>Tigsite (PHP)</h1>
<div class="intro">
This tool assists the development of a web site containing static pages. It was developed to help writing <a href="https://tig12.net">tig12.net</a>
<br>Tigsite could be called a "reverse-framework": instead of storing the information in a database and write code to generate web pages, the information is directly stored in the html pages, and the <code>tigsite</code> code modifies the html pages.
<br>Mainly used to handle navigation or modifications on all pages.
</div>
</header>

<article>
<div class="pagetoc">
    <ul>
        <li>
            <a href="#1-installation">Installation</a>
        </li>
        <li>
            <a href="#2-overview">Overview</a>
        </li>
        <li>
            <a href="#3-site-configuration">Site configuration</a>
            <ul>
                <li>
                    <a href="#3-1-config-yml">config.yml</a>
                </li>
            </ul>
        </li>
        <li>
            <a href="#4-page-configuration">Page configuration</a>
        </li>
        <li>
            <a href="#5-command-files">Command files</a>
        </li>
        <li>
            <a href="#6-available-commands">Available commands</a>
            <ul>
                <li>
                    <a href="#6-1-inserthtml">insertHtml</a>
                </li>
                <li>
                    <a href="#6-2-replacehtml">replaceHtml</a>
                </li>
                <li>
                    <a href="#6-3-pagetoc-table-of-contents">pagetoc (table of contents)</a>
                </li>
            </ul>
        </li>
        <li>
            <a href="#7-variable-substitution">Variable substitution</a>
        </li>
    </ul>
</div>

<!-- ********************************************************************************* -->
<h2 id="1-installation">Installation</h2>
This software has been developed and tested on Linux Debian. It should normally also work on Windows and Macintosh, but hasn't been tested.

<br>Before starting, you need to install <b>PHP</b> (version 8.0 or higher) on your machine.
<br>Some PHP extensions are also necessary ; on debian:
<pre>sudo apt install php8.0-yaml</pre>

<!-- ********************************************************************************* -->
<h2 id="2-overview">Overview</h2>

<pre>
tigsite
    ├── docs
    ├── config
    |   ├── mysite1
    |   ├── mysite2
    |   └── ...
    ├── src
    └── run-tigsite.php
</pre>

The tool is run on the command line :
<pre>
cd tigsite/
<b class="big2">php run-tigsite.php &lt;site> &lt;command></b>
</pre>

<code class="bold">&lt;site></code> must be the name of a sub-directory of <code>config/</code>.
<br><code class="bold">&lt;command></code> must be the name of a yaml file inside site's <code>commands/</code> sub-directory.
<br>
<br>For example, 
<pre class="bold">php run-tigsite.php site1 replace-footer</pre>

corresponds to this hierarchy :

<pre>
config/
    └── site1
        ├── commands
        │   └── replace-footer.yml
        └── config.yml
</pre>

<ul>
    <li>The command name specified does not include the "<code>.yml</code>" extension.</li>
    <li>
        Commands can be organized in subdirectories.
        <br>For example,
        <pre class="bold">php run-tigsite.php site1 asides/replace-footer</pre>
        corresponds to 
<pre>
config/
    └── site1
        ├── commands
        │   └── asides
        │        └── replace-footer.yml
        └── config.yml
</pre>
    </li>
</ul>

<!-- ********************************************************************************* -->
<h2 id="3-site-configuration">Site configuration</h2>
Each site managed by this tool must correspond to a sub-directory of <code>config/</code> and have this structure :
<pre>
config/
    └── mysite.org
        ├── commands/
        └── config.yml
</pre>

<!-- ************************************* -->
<h3 id="3-1-config-yml">config.yml</h3>

Configuration file containing information used by all commands related to the site.
<br>Example :
<pre class="bold">
site-root: /path/to/the/site/web
exclude:
  - .git
  - .gitignore
  - static
</pre>

<table class="wikitable margin">
    <tr><th>Directive</th><th>Description</th><th></th><th>Default</th></tr>
    <tr>
        <td><code>site-root</code></td>
        <td>Absolute path to the root directory of the site.</td>
        <td>Required</td>
        <td></td>
    </tr>
    <tr>
        <td><code>exclude</code></td>
        <td>
            Array of strings containing regular expressions of relative paths (relative to <code>site-root</code>) to files to exclude from processing.
        </td>
        <td>Optional</td>
        <td><code>[]</code></td>
    </tr>
</table>

<!-- ********************************************************************************* -->
<h2 id="4-page-configuration">Page configuration</h2>
Each html page of a site may contain its own configuration, used by some commands.
<br>Page configuration is a piece of yaml included in a html comment, typically located in the <code>&lt;head></code> part of the page
<br>This yaml must contain a directive <code>tigsite</code> which contains the configuration directives.
<br>
<br>Example :
<pre class="bold">
&lt;head>
    &lt;!-- 
    tigsite:
        sidebar-right: genealogy/sidebar-genealogy.fr.html
    -->
&lt;/head>
</pre>

<!-- ********************************************************************************* -->
<h2 id="5-command-files">Command files</h2>

When executing the program, the yaml files located in <code>config/&lt;my-site>/commands/</code> are used to specify :
<ul>
    <li>which command is used,</li>
    <li>the parameters passed to the command.</li>
</ul>
See below for examples of a command file.
<br>The available commands are located in <code>src/commands</code>.
<br>In a command file, the unique required directive is <code><b>command-class</b></code>
<br>The other directives depend on the command ; they are passed as parameters to the command.

<!-- 
TODO document expanded variables {{path-to-root}}
-->

<!-- ********************************************************************************* -->
<h2 id="6-available-commands">Available commands</h2>

<!-- ************************************* -->
<h3 id="6-1-inserthtml">insertHtml</h3>
Permits to insert html in one or several html page(s).
<br>To work, all concerned pages must have a common fragment of html to mark where the html will be inserted.
<br>The place where the html string should be inserted is marked using either parameter <code>before</code> or <code>after</code>.
<br>The string to insert is specified using either <code>insert-string</code> or <code>insert-file</code>.
<br>The computation of inserted string supports the use of <a href="#7-variable-substitution">variable substitution</a>.

<table class="wikitable margin">
    <tr><th>Parameter</th><th>Description</th><th></th><th>Default</th></tr>
    <tr>
        <td><code>before</code></td>
        <td>
            HTML fragment of the page(s) that will be located before the inserted string
            <br>(the inserted string will be located after this fragment).
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>after</code></td>
        <td>
            HTML fragment of the page(s) that will be located after the inserted string
            <br>(the inserted string will be located before this fragment).
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>insert-string</code></td>
        <td>
            String to insert, directly specified in the yaml command file.
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>insert-file</code></td>
        <td>
            Relative path (relative to <code>site-root</code>) to a file contianing the string to insert.
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>exclude</code></td>
        <td>
            Supplementary files to be ignored. Added to parameter <code>exclude</code> of site configuration. See <a href="#3-1-config-yml">config.yml</a>.
        </td>
        <td>Optional</td>
        <td><code>[]</code></td>
    </tr>
</table>

Example of command file:
<pre>
#
# Command to replace the right sidebar
# Uses the page configuration directive 'sidebar-right'
#

#
# Class of src/commands/ using this config
#
command-class: replaceHtml

#
# Command parameters
#
before: '<aside class="sidebar-right">'
after: '</aside>'
replacement-directive: sidebar-right
</pre>

<!-- ************************************* -->
<h3 id="6-2-replacehtml">replaceHtml</h3>

Permits to replace existing html in one or several pages.
<br>To work, all concerned pages must have 2 common fragments of html to mark where the html will be replaced.
<br>The place where the html string should be replaced is marked using parameters <code>before</code> and <code>after</code>.
<br>The new string is specified by one of the parameters <code>replacement-string</code>, <code>replacement-file</code> or <code>replacement-directive</code>
<br>The computation of replacement string supports the use of <a href="#7-variable-substitution">variable substitution</a>.

<table class="wikitable margin">
    <tr><th>Parameter</th><th>Description</th><th></th><th>Default</th></tr>
    <tr>
        <td><code>before</code></td>
        <td>
            HTML fragment of the page(s) that will be located before the replacement string
            <br>(the replacement string will be located after this fragment).
        </td>
        <td>Required</td>
        <td></td>
    </tr>
    <tr>
        <td><code>after</code></td>
        <td>
            HTML fragment of the page(s) that will be located after the replacement string
            <br>(the replacement string will be located before this fragment).
        </td>
        <td>Required</td>
        <td></td>
    </tr>
    <tr>
        <td><code>replacement-string</code></td>
        <td>
            Replacement string, directly specified in the yaml command file.
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>replacement-file</code></td>
        <td>
            Relative path (relative to <code>site-root</code>) to a file contianing the replacement string.
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>replacement-directive</code></td>
        <td>
            String containing the directive of a <a href="#4-page-configuration">page configuration</a>.
            <br>This directive indicates the path to a file containing the new html code to insert between 'before' and 'after'.
            <br>Pages that do not contain the specified directive are not processed.
        </td>
        <td>Optional</td>
        <td><code>null</code></td>
    </tr>
    <tr>
        <td><code>exclude</code></td>
        <td>
            Supplementary files to be ignored. Added to parameter <code>exclude</code> of site configuration. See <a href="#3-1-config-yml">config.yml</a>.
        </td>
        <td>Optional</td>
        <td><code>[]</code></td>
    </tr>
</table>

Example of command file using <code>replacement-directive</code>:
<pre>
#
# Command to replace the right sidebar
# Uses the page configuration directive 'sidebar-right'
#

#
# Class of src/commands/ using this config
#
command-class: replaceHtml

#
# Command parameters
#
before: '&lt;aside class="sidebar-right">'
after: '&lt;/aside>'
replacement-directive: sidebar-right
</pre>

It permits to have one specific sidebar per page.
<br>Pages containing a <a href="#4-page-configuration">page configuration</a> like this are processed:
<pre>
    &lt;!-- 
    tigsite:
        sidebar-right: astronomy/sidebar-astronomy.html
    -->
</pre>
Here, the replacement string will be the content of file <code>astronomy/sidebar-astronomy.html</code>.

<!-- ************************************* -->
<h3 id="6-3-pagetoc-table-of-contents">pagetoc (table of contents)</h3>
Permits to compute the table of contents (toc) of one or several html page(s) from a given list of html tags.
<br>For example, the toc of this page was generated from h2 and h3 tags.

<table class="wikitable margin">
    <tr><th>Parameter</th><th>Description</th><th></th><th>Default</th></tr>
    <tr>
        <td><code>action</code></td>
        <td>
            String describing the action to execute
            <br>Can take one of thes values:
            <table>
                <tr>
                    <td><code>save</code></td>
                    <td>the original file(s) are overwritten with the new toc.</td>
                </tr>
                <tr>
                    <td><code>print-toc</code></td>
                    <td>Prints the new toc without overwriting the original files.</td>
                </tr>
                <tr>
                    <td><code>print-full</code></td>
                    <td>Prints the whole generated page(s) without overwriting the original files.</td>
                </tr>
            </table>
        </td>
        <td>Optional</td>
        <td><code>'save'</code></td>
    </tr>
    <tr>
        <td><code>tags</code></td>
        <td>
            Array of strings designating the html tags used to build the toc.
        </td>
        <td>Optional</td>
        <td><code>['h2', 'h3']</code></td>
    </tr>
    <tr>
        <td><code>file</code></td>
        <td>
            String containing the relative path of the file to process.
            <br>If not specified, all the files specified in the site configuration (<code>root-dir</code> in <code>config.yml</code>) are processed.
        </td>
        <td>Optional</td>
        <td>Empty string</td>
    </tr>
    <tr>
        <td><code>excludes</code></td>
        <td>
            Array of strings containing relative paths of html files to exclude from site <code>root-dir</code>.
            <br>If parameter <code>file</code> is specified, this parameter is ignored.
        </td>
        <td>Optional</td>
        <td><code>[]</code></td>
    </tr>
    <tr>
        <td><code>toc-css-class</code></td>
        <td>
            String, CSS class of the div containing the generated toc.
        </td>
        <td>Optional</td>
        <td><code>pagetoc</code></td>
    </tr>
    <tr>
        <td><code>toc-tab-length</code></td>
        <td>
            Number of white spaces used to indent the pagetoc list.
        </td>
        <td>Optional</td>
        <td><code>4</code></td>
    </tr>
    <tr>
        <td><code>insert-after</code></td>
        <td>
            In the resulting page, the toc is inserted after this html fragment of the original page.
        </td>
        <td>Optional</td>
        <td><code>&lt;body></code></td>
    </tr>
    <tr>
        <td><code>backup</code></td>
        <td>
            Boolean indicating if a copy of the original files should be stored in the same directory.
            <br>Used only if parameter <code>action</code> = <code>save</code>
        </td>
        <td>Optional</td>
        <td><code>false</code></td>
    </tr>
    <tr>
        <td><code>backup-extension</code></td>
        <td>
            String appended to the original file name when creating the backup files.
            <br>Used only if parameter <code>backup</code> = true
        </td>
        <td>Optional</td>
        <td><code>.bck</code></td>
    </tr>
</table>


<!-- ********************************************************************************* -->
<h2 id="7-variable-substitution">Variable substitution</h2>
Mechanism used by certain commands (<a href="#6-1-inserthtml">insertHtml</a> and <a href="#6-2-replacehtml">replaceHtml</a>) to deal with strings that depend on the currently processed html file.
<br>A special syntax permits to replace strings located between {{ and }} by computed strings.

<br><br>Currently, the supported strings are:
<table class="wikitable margin">
    <tr>
        <td><code>{{path-to-root}}</code></td>
        <td>Relative html path between the file currently processed and the root directory of the site.</td>
    </tr>
</table>

<br>
</article>

</body>
</html>
